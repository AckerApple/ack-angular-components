import { copyFileInDir, findDirectoryWithin, getNameByPath, renameFileInDir } from "./DirectoryManagers";
import { path } from "./path";
import { BrowserDmFileReader } from "./BrowserDmFileReader";
export class SafariDirectoryManager {
    constructor(path = '', files) {
        this.path = path;
        this.files = files;
        this.name = getNameByPath(path);
    }
    async copyFile(oldFileName, newFileName) {
        return copyFileInDir(oldFileName, newFileName, this);
    }
    async renameFile(oldFileName, newFileName) {
        return renameFileInDir(oldFileName, newFileName, this);
    }
    /** ⚠️ does not actually work */
    removeEntry(_name, _options) {
        throw 'removeEntry does not work in Safari';
    }
    findDirectory(path, options) {
        return findDirectoryWithin(path, this, options);
    }
    /** ⚠️ does not actually work */
    createDirectory(newPath) {
        return this.getDirectory(newPath);
    }
    async getDirectory(path) {
        // safari gives you all items up front
        const nextItems = this.files.filter(file => {
            const relative = getWebkitPathRelativeTo(file, this.path);
            return relative.substring(0, path.length).toLowerCase() === path.toLowerCase();
        });
        return new SafariDirectoryManager(path, nextItems);
    }
    getRelativeItems() {
        return this.files.filter(file => {
            const relative = getWebkitPathRelativeTo(file, this.path);
            return relative.split('/').length === 1; // lives within same directory
        });
    }
    async list() {
        return this.getRelativeItems().map(file => file.name);
    }
    async listFolders() {
        return this.getRelativeItems()
            .filter(file => file.name.split('.').length === 1)
            .map(file => file.name);
    }
    async listFiles() {
        return this.getRelativeItems().map(file => file.name);
    }
    async getFolders() {
        return Promise.all((await this.listFolders()).map(async (name) => await this.getDirectory(name)));
    }
    async getFiles() {
        return this.getRelativeItems().map(file => new BrowserDmFileReader(file, this));
    }
    async findFileByPath(filePath) {
        if (!this.files.length) {
            return;
        }
        // safari include the parent folder name so we need to prepend it to the file search
        const rootName = this.files[0].webkitRelativePath.split('/').shift();
        filePath = path.join(rootName, this.path, filePath);
        // safari just gives us every files upfront, find within that (huge) array
        const file = this.files.find(file => file.webkitRelativePath === filePath);
        return file ? new BrowserDmFileReader(file, this) : undefined;
    }
    async file(fileName, _options) {
        const findFile = await this.findFileByPath(fileName);
        if (findFile) {
            return findFile;
        }
        const superFile = new BrowserDmFileReader(new File([], fileName), this);
        return Promise.resolve(superFile);
    }
}
function getWebkitPathRelativeTo(file, path) {
    const relativeSplit = file.webkitRelativePath.split('/');
    relativeSplit.shift(); // remove the first notation on safari results
    if (path !== '') {
        let splitCount = path.split('/').length;
        while (splitCount) {
            relativeSplit.shift(); // remove starting notations on safari results
            --splitCount;
        }
    }
    return relativeSplit.join('/');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2FmYXJpRGlyZWN0b3J5TWFuYWdlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZGlyZWN0b3J5LW1hbmFnZXJzL1NhZmFyaURpcmVjdG9yeU1hbmFnZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBb0IsYUFBYSxFQUFFLG1CQUFtQixFQUFFLGFBQWEsRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQTtBQUMxSCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFBO0FBRTdCLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHVCQUF1QixDQUFBO0FBRTNELE1BQU0sT0FBTyxzQkFBc0I7SUFHakMsWUFDUyxPQUFlLEVBQUUsRUFDakIsS0FBYTtRQURiLFNBQUksR0FBSixJQUFJLENBQWE7UUFDakIsVUFBSyxHQUFMLEtBQUssQ0FBUTtRQUVwQixJQUFJLENBQUMsSUFBSSxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNqQyxDQUFDO0lBRUQsS0FBSyxDQUFDLFFBQVEsQ0FDWixXQUFtQixFQUNuQixXQUFtQjtRQUVuQixPQUFPLGFBQWEsQ0FBQyxXQUFXLEVBQUUsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQ3RELENBQUM7SUFFRCxLQUFLLENBQUMsVUFBVSxDQUNkLFdBQW1CLEVBQ25CLFdBQW1CO1FBRW5CLE9BQU8sZUFBZSxDQUFDLFdBQVcsRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDeEQsQ0FBQztJQUVELGdDQUFnQztJQUNoQyxXQUFXLENBQ1QsS0FBYSxFQUNiLFFBQWlDO1FBRWpDLE1BQU0scUNBQXFDLENBQUE7SUFDN0MsQ0FBQztJQUVELGFBQWEsQ0FDWCxJQUFZLEVBQ1osT0FBdUM7UUFFdkMsT0FBTyxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFBO0lBQ2pELENBQUM7SUFFRCxnQ0FBZ0M7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LENBQUE7QUFDaEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdG9yeU1hbmFnZXIsIGNvcHlGaWxlSW5EaXIsIGZpbmREaXJlY3RvcnlXaXRoaW4sIGdldE5hbWVCeVBhdGgsIHJlbmFtZUZpbGVJbkRpciB9IGZyb20gXCIuL0RpcmVjdG9yeU1hbmFnZXJzXCJcbmltcG9ydCB7IHBhdGggfSBmcm9tIFwiLi9wYXRoXCJcbmltcG9ydCB7IERtRmlsZVJlYWRlciB9IGZyb20gXCIuL0RtRmlsZVJlYWRlclwiXG5pbXBvcnQgeyBCcm93c2VyRG1GaWxlUmVhZGVyIH0gZnJvbSBcIi4vQnJvd3NlckRtRmlsZVJlYWRlclwiXG5cbmV4cG9ydCBjbGFzcyBTYWZhcmlEaXJlY3RvcnlNYW5hZ2VyIGltcGxlbWVudHMgRGlyZWN0b3J5TWFuYWdlciB7XG4gIG5hbWU6IHN0cmluZ1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBwYXRoOiBzdHJpbmcgPSAnJyxcbiAgICBwdWJsaWMgZmlsZXM6IEZpbGVbXSxcbiAgKSB7XG4gICAgdGhpcy5uYW1lID0gZ2V0TmFtZUJ5UGF0aChwYXRoKVxuICB9XG5cbiAgYXN5bmMgY29weUZpbGUoXG4gICAgb2xkRmlsZU5hbWU6IHN0cmluZyxcbiAgICBuZXdGaWxlTmFtZTogc3RyaW5nXG4gICkge1xuICAgIHJldHVybiBjb3B5RmlsZUluRGlyKG9sZEZpbGVOYW1lLCBuZXdGaWxlTmFtZSwgdGhpcylcbiAgfVxuXG4gIGFzeW5jIHJlbmFtZUZpbGUoXG4gICAgb2xkRmlsZU5hbWU6IHN0cmluZyxcbiAgICBuZXdGaWxlTmFtZTogc3RyaW5nXG4gICkge1xuICAgIHJldHVybiByZW5hbWVGaWxlSW5EaXIob2xkRmlsZU5hbWUsIG5ld0ZpbGVOYW1lLCB0aGlzKVxuICB9XG5cbiAgLyoqIOKaoO+4jyBkb2VzIG5vdCBhY3R1YWxseSB3b3JrICovXG4gIHJlbW92ZUVudHJ5KFxuICAgIF9uYW1lOiBzdHJpbmcsXG4gICAgX29wdGlvbnM/OiB7IHJlY3Vyc2l2ZTogYm9vbGVhbiB9XG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRocm93ICdyZW1vdmVFbnRyeSBkb2VzIG5vdCB3b3JrIGluIFNhZmFyaSdcbiAgfVxuXG4gIGZpbmREaXJlY3RvcnkgKFxuICAgIHBhdGg6IHN0cmluZyxcbiAgICBvcHRpb25zPzogRmlsZVN5c3RlbUdldERpcmVjdG9yeU9wdGlvbnMsXG4gICk6IFByb21pc2U8RGlyZWN0b3J5TWFuYWdlciB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiBmaW5kRGlyZWN0b3J5V2l0aGluKHBhdGgsIHRoaXMsIG9wdGlvbnMpXG4gIH1cblxuICAvKiog4pqg77iPIGRvZXMgbm90IGFjdHVhbGx5IHdvcmsgKi9cbiAgY3JlYXRlRGlyZWN0b3J5KG5ld1BhdGg6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmdldERpcmVjdG9yeShuZXdQYXRoKVxuICB9XG5cbiAgYXN5bmMgZ2V0RGlyZWN0b3J5KHBhdGg6IHN0cmluZykge1xuICAgIC8vIHNhZmFyaSBnaXZlcyB5b3UgYWxsIGl0ZW1zIHVwIGZyb250XG4gICAgY29uc3QgbmV4dEl0ZW1zID0gdGhpcy5maWxlcy5maWx0ZXIoZmlsZSA9PiB7XG4gICAgICBjb25zdCByZWxhdGl2ZSA9IGdldFdlYmtpdFBhdGhSZWxhdGl2ZVRvKGZpbGUsIHRoaXMucGF0aClcbiAgICAgIHJldHVybiByZWxhdGl2ZS5zdWJzdHJpbmcoMCwgcGF0aC5sZW5ndGgpLnRvTG93ZXJDYXNlKCkgPT09IHBhdGgudG9Mb3dlckNhc2UoKVxuICAgIH0pXG4gICAgcmV0dXJuIG5ldyBTYWZhcmlEaXJlY3RvcnlNYW5hZ2VyKHBhdGgsIG5leHRJdGVtcylcbiAgfVxuXG4gIGdldFJlbGF0aXZlSXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZmlsZXMuZmlsdGVyKGZpbGUgPT4ge1xuICAgICAgY29uc3QgcmVsYXRpdmUgPSBnZXRXZWJraXRQYXRoUmVsYXRpdmVUbyhmaWxlLCB0aGlzLnBhdGgpXG4gICAgICByZXR1cm4gcmVsYXRpdmUuc3BsaXQoJy8nKS5sZW5ndGggPT09IDEgLy8gbGl2ZXMgd2l0aGluIHNhbWUgZGlyZWN0b3J5XG4gICAgfSlcbiAgfVxuXG4gIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIHJldHVybiB0aGlzLmdldFJlbGF0aXZlSXRlbXMoKS5tYXAoZmlsZSA9PiBmaWxlLm5hbWUpXG4gIH1cblxuICBhc3luYyBsaXN0Rm9sZGVycygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0UmVsYXRpdmVJdGVtcygpXG4gICAgICAuZmlsdGVyKGZpbGUgPT4gZmlsZS5uYW1lLnNwbGl0KCcuJykubGVuZ3RoID09PSAxKVxuICAgICAgLm1hcChmaWxlID0+IGZpbGUubmFtZSlcbiAgfVxuXG4gIGFzeW5jIGxpc3RGaWxlcygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0UmVsYXRpdmVJdGVtcygpLm1hcChmaWxlID0+IGZpbGUubmFtZSlcbiAgfVxuICBcbiAgYXN5bmMgZ2V0Rm9sZGVycygpOiBQcm9taXNlPFNhZmFyaURpcmVjdG9yeU1hbmFnZXJbXT4ge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChcbiAgICAgIChhd2FpdCB0aGlzLmxpc3RGb2xkZXJzKCkpLm1hcChhc3luYyBuYW1lID0+IGF3YWl0IHRoaXMuZ2V0RGlyZWN0b3J5KG5hbWUpKVxuICAgIClcbiAgfVxuXG4gIGFzeW5jIGdldEZpbGVzKCk6IFByb21pc2U8RG1GaWxlUmVhZGVyW10+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRSZWxhdGl2ZUl0ZW1zKCkubWFwKGZpbGUgPT4gbmV3IEJyb3dzZXJEbUZpbGVSZWFkZXIoZmlsZSwgdGhpcykpXG4gIH1cblxuICBhc3luYyBmaW5kRmlsZUJ5UGF0aCAoZmlsZVBhdGg6IHN0cmluZyApOiBQcm9taXNlPEJyb3dzZXJEbUZpbGVSZWFkZXIgfCB1bmRlZmluZWQ+IHtcbiAgICBpZiAoICF0aGlzLmZpbGVzLmxlbmd0aCApIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIC8vIHNhZmFyaSBpbmNsdWRlIHRoZSBwYXJlbnQgZm9sZGVyIG5hbWUgc28gd2UgbmVlZCB0byBwcmVwZW5kIGl0IHRvIHRoZSBmaWxlIHNlYXJjaFxuICAgIGNvbnN0IHJvb3ROYW1lID0gdGhpcy5maWxlc1swXS53ZWJraXRSZWxhdGl2ZVBhdGguc3BsaXQoJy8nKS5zaGlmdCgpIGFzIHN0cmluZ1xuICAgIGZpbGVQYXRoID0gcGF0aC5qb2luKHJvb3ROYW1lLCB0aGlzLnBhdGgsIGZpbGVQYXRoKVxuICAgIFxuICAgIC8vIHNhZmFyaSBqdXN0IGdpdmVzIHVzIGV2ZXJ5IGZpbGVzIHVwZnJvbnQsIGZpbmQgd2l0aGluIHRoYXQgKGh1Z2UpIGFycmF5XG4gICAgY29uc3QgZmlsZSA9IHRoaXMuZmlsZXMuZmluZChmaWxlID0+IGZpbGUud2Via2l0UmVsYXRpdmVQYXRoID09PSBmaWxlUGF0aCkgYXMgRmlsZSB8IHVuZGVmaW5lZFxuICAgIHJldHVybiBmaWxlID8gbmV3IEJyb3dzZXJEbUZpbGVSZWFkZXIoZmlsZSwgdGhpcykgOiB1bmRlZmluZWRcbiAgfVxuXG4gIGFzeW5jIGZpbGUoZmlsZU5hbWU6IHN0cmluZywgX29wdGlvbnM/OiBGaWxlU3lzdGVtR2V0RmlsZU9wdGlvbnMpIHtcbiAgICBjb25zdCBmaW5kRmlsZSA9IGF3YWl0IHRoaXMuZmluZEZpbGVCeVBhdGgoZmlsZU5hbWUpXG5cbiAgICBpZiAoIGZpbmRGaWxlICkge1xuICAgICAgcmV0dXJuIGZpbmRGaWxlXG4gICAgfVxuXG4gICAgY29uc3Qgc3VwZXJGaWxlID0gbmV3IEJyb3dzZXJEbUZpbGVSZWFkZXIobmV3IEZpbGUoW10sIGZpbGVOYW1lKSwgdGhpcylcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHN1cGVyRmlsZSlcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRXZWJraXRQYXRoUmVsYXRpdmVUbyhmaWxlOiBGaWxlLCBwYXRoOiBzdHJpbmcpIHtcbiAgY29uc3QgcmVsYXRpdmVTcGxpdCA9IGZpbGUud2Via2l0UmVsYXRpdmVQYXRoLnNwbGl0KCcvJylcbiAgcmVsYXRpdmVTcGxpdC5zaGlmdCgpIC8vIHJlbW92ZSB0aGUgZmlyc3Qgbm90YXRpb24gb24gc2FmYXJpIHJlc3VsdHNcbiAgaWYgKCBwYXRoICE9PSAnJyApIHtcbiAgICBsZXQgc3BsaXRDb3VudCA9IHBhdGguc3BsaXQoJy8nKS5sZW5ndGhcbiAgICB3aGlsZSAoc3BsaXRDb3VudCkge1xuICAgICAgcmVsYXRpdmVTcGxpdC5zaGlmdCgpIC8vIHJlbW92ZSBzdGFydGluZyBub3RhdGlvbnMgb24gc2FmYXJpIHJlc3VsdHNcbiAgICAgIC0tc3BsaXRDb3VudFxuICAgIH1cbiAgfVxuICByZXR1cm4gcmVsYXRpdmVTcGxpdC5qb2luKCcvJylcbn0iXX0=