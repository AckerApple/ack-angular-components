import { convertSlashes } from "./convertSlashes";
import { BaseDmFileReader, findDirectoryWithin, getNameByPath } from "./DirectoryManagers";
import { path } from "./path";
const fs = typeof Neutralino === 'object' ? Neutralino.filesystem : {};
export class NeutralinoDmFileReader extends BaseDmFileReader {
    constructor(filePath, directory) {
        super();
        this.filePath = filePath;
        this.directory = directory;
        this.name = filePath.split('/').pop();
    }
    async stats() {
        const stats = await fs.getStats(this.filePath);
        stats.name = stats.name || this.name;
        return stats;
    }
    readAsText() {
        return fs.readFile(this.filePath); // .toString()
    }
    async readAsDataURL() {
        let data = await fs.readBinaryFile(this.filePath);
        const view = new Uint8Array(data);
        var decoder = new TextDecoder('utf8');
        var b64encoded = btoa(decoder.decode(view));
        return b64encoded;
    }
    async write(fileString) {
        return fs.writeFile(this.filePath, fileString);
    }
}
export class NeutralinoDirectoryManager {
    constructor(path) {
        this.path = path;
        this.name = getNameByPath(path);
    }
    findDirectory(path, options) {
        return findDirectoryWithin(path, this, options);
    }
    async list() {
        const reads = await Neutralino.filesystem.readDirectory(this.path);
        return reads.filter(read => !['.', '..'].includes(read.entry)).map(read => read.entry);
    }
    async listFolders() {
        const reads = await Neutralino.filesystem.readDirectory(this.path);
        return reads.filter(read => !['.', '..'].includes(read.entry) && read.type === 'DIRECTORY')
            .map(read => read.entry);
    }
    async listFiles() {
        const reads = await Neutralino.filesystem.readDirectory(this.path);
        return reads.filter(read => !['.', '..'].includes(read.entry) && read.type !== 'DIRECTORY')
            .map(read => read.entry);
    }
    async getFolders() {
        return Promise.all((await this.listFolders()).map(async (name) => await this.getDirectory(name)));
    }
    async getFiles() {
        const reads = await Neutralino.filesystem.readDirectory(this.path);
        return reads.filter(read => !['.', '..'].includes(read.entry) && read.type !== 'DIRECTORY')
            .map(read => new NeutralinoDmFileReader(this.getFullPath(read.entry), this));
    }
    async getDirectory(newPath) {
        const pathTo = path.join(this.path, newPath);
        // ensure path exists
        await Neutralino.filesystem.readDirectory(pathTo);
        return new NeutralinoDirectoryManager(pathTo);
    }
    async findFileByPath(filePath) {
        const fullFilePath = this.getFullPath(filePath);
        return new NeutralinoDmFileReader(fullFilePath, this);
    }
    file(fileName, _options) {
        return this.findFileByPath(fileName);
    }
    getFullPath(itemPath) {
        let fullFilePath = path.join(this.path, itemPath);
        return convertSlashes(fullFilePath);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTmV1dHJhbGlub0RpcmVjdG9yeU1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZGlyZWN0b3J5LW1hbmFnZXJzL05ldXRyYWxpbm9EaXJlY3RvcnlNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUNqRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQWtDLG1CQUFtQixFQUFFLGFBQWEsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBQzFILE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxRQUFRLENBQUE7QUFjN0IsTUFBTSxFQUFFLEdBQUcsT0FBTyxVQUFVLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFtQixDQUFBO0FBRXZGLE1BQU0sT0FBTyxzQkFBdUIsU0FBUSxnQkFBZ0I7SUFHMUQsWUFDUyxRQUFnQixFQUNoQixTQUFxQztRQUU1QyxLQUFLLEVBQUUsQ0FBQTtRQUhBLGFBQVEsR0FBUixRQUFRLENBQVE7UUFDaEIsY0FBUyxHQUFULFNBQVMsQ0FBNEI7UUFHNUMsSUFBSSxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBWSxDQUFBO0lBQ2pELENBQUM7SUFFRCxLQUFLLENBQUMsS0FBSztRQUNULE1BQU0sS0FBSyxHQUFHLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDOUMsS0FBSyxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUE7UUFDcEMsT0FBTyxLQUFLLENBQUE7SUFDZCxDQUFDO0lBRVEsVUFBVTtRQUNqQixPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBLENBQUMsY0FB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QUFJLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFDakQsT0FBTyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUE7SUFDckMsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29udmVydFNsYXNoZXMgfSBmcm9tIFwiLi9jb252ZXJ0U2xhc2hlc1wiXG5pbXBvcnQgeyBCYXNlRG1GaWxlUmVhZGVyLCBEaXJlY3RvcnlNYW5hZ2VyLCBEbUZpbGVSZWFkZXIsIGZpbmREaXJlY3RvcnlXaXRoaW4sIGdldE5hbWVCeVBhdGggfSBmcm9tIFwiLi9EaXJlY3RvcnlNYW5hZ2Vyc1wiXG5pbXBvcnQgeyBwYXRoIH0gZnJvbSBcIi4vcGF0aFwiXG5cbmludGVyZmFjZSBJTmV1dHJhbGlubyB7XG4gIGZpbGVzeXN0ZW06IElOZXV0cmFsaW5vRnNcbn1cbmludGVyZmFjZSBJTmV1dHJhbGlub0ZzIHtcbiAgZ2V0U3RhdHM6IChwYXRoOiBzdHJpbmcpID0+IGFueVxuICByZWFkRmlsZTogKHBhdGg6IHN0cmluZykgPT4gYW55XG4gIHJlYWRCaW5hcnlGaWxlOiAocGF0aDogc3RyaW5nKSA9PiBhbnlcbiAgd3JpdGVGaWxlOiAocGF0aDogc3RyaW5nLCBkYXRhOiBzdHJpbmcpID0+IGFueVxuICByZWFkRGlyZWN0b3J5OiAocGF0aDogc3RyaW5nKSA9PiBQcm9taXNlPHtlbnRyeTogJ0ZJTEUnIHwgJ0RJUkVDVE9SWScsIHR5cGU6IHN0cmluZ31bXT5cbn1cblxuZGVjbGFyZSBjb25zdCBOZXV0cmFsaW5vOiBJTmV1dHJhbGlub1xuY29uc3QgZnMgPSB0eXBlb2YgTmV1dHJhbGlubyA9PT0gJ29iamVjdCcgPyBOZXV0cmFsaW5vLmZpbGVzeXN0ZW0gOiB7fSBhcyBJTmV1dHJhbGlub0ZzXG5cbmV4cG9ydCBjbGFzcyBOZXV0cmFsaW5vRG1GaWxlUmVhZGVyIGV4dGVuZHMgQmFzZURtRmlsZVJlYWRlciBpbXBsZW1lbnRzIERtRmlsZVJlYWRlciB7XG4gIG5hbWU6IHN0cmluZ1xuICBcbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGZpbGVQYXRoOiBzdHJpbmcsXG4gICAgcHVibGljIGRpcmVjdG9yeTogTmV1dHJhbGlub0RpcmVjdG9yeU1hbmFnZXIsXG4gICkge1xuICAgIHN1cGVyKClcbiAgICB0aGlzLm5hbWUgPSBmaWxlUGF0aC5zcGxpdCgnLycpLnBvcCgpIGFzIHN0cmluZ1xuICB9XG5cbiAgYXN5bmMgc3RhdHMoKSB7XG4gICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBmcy5nZXRTdGF0cyh0aGlzLmZpbGVQYXRoKVxuICAgIHN0YXRzLm5hbWUgPSBzdGF0cy5uYW1lIHx8IHRoaXMubmFtZVxuICAgIHJldHVybiBzdGF0c1xuICB9XG5cbiAgb3ZlcnJpZGUgcmVhZEFzVGV4dCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBmcy5yZWFkRmlsZSh0aGlzLmZpbGVQYXRoKSAvLyAudG9TdHJpbmcoKVxuICB9XG4gIFxuICBhc3luYyByZWFkQXNEYXRhVVJMKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgbGV0IGRhdGEgPSBhd2FpdCBmcy5yZWFkQmluYXJ5RmlsZSh0aGlzLmZpbGVQYXRoKVxuICAgIGNvbnN0IHZpZXcgPSBuZXcgVWludDhBcnJheShkYXRhKTtcbiAgICB2YXIgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigndXRmOCcpO1xuICAgIHZhciBiNjRlbmNvZGVkID0gYnRvYShkZWNvZGVyLmRlY29kZSh2aWV3KSlcbiAgICByZXR1cm4gYjY0ZW5jb2RlZFxuICB9XG5cbiAgYXN5bmMgd3JpdGUoZmlsZVN0cmluZzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGZzLndyaXRlRmlsZSh0aGlzLmZpbGVQYXRoLCBmaWxlU3RyaW5nKVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBOZXV0cmFsaW5vRGlyZWN0b3J5TWFuYWdlciBpbXBsZW1lbnRzIERpcmVjdG9yeU1hbmFnZXIge1xuICBuYW1lOiBzdHJpbmdcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgcGF0aDogc3RyaW5nLFxuICApIHtcbiAgICB0aGlzLm5hbWUgPSBnZXROYW1lQnlQYXRoKHBhdGgpXG4gIH1cblxuICBmaW5kRGlyZWN0b3J5IChcbiAgICBwYXRoOiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IEZpbGVTeXN0ZW1HZXREaXJlY3RvcnlPcHRpb25zLFxuICApOiBQcm9taXNlPERpcmVjdG9yeU1hbmFnZXIgfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gZmluZERpcmVjdG9yeVdpdGhpbihwYXRoLCB0aGlzLCBvcHRpb25zKVxuICB9XG5cbiAgYXN5bmMgbGlzdCgpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgcmVhZHMgPSBhd2FpdCBOZXV0cmFsaW5vLmZpbGVzeXN0ZW0ucmVhZERpcmVjdG9yeSggdGhpcy5wYXRoIClcbiAgICByZXR1cm4gcmVhZHMuZmlsdGVyKHJlYWQgPT4gIVsnLicsJy4uJ10uaW5jbHVkZXMocmVhZC5lbnRyeSkpLm1hcChyZWFkID0+IHJlYWQuZW50cnkpXG4gIH1cblxuICBhc3luYyBsaXN0Rm9sZGVycygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgcmVhZHMgPSBhd2FpdCBOZXV0cmFsaW5vLmZpbGVzeXN0ZW0ucmVhZERpcmVjdG9yeSggdGhpcy5wYXRoIClcbiAgICByZXR1cm4gcmVhZHMuZmlsdGVyKHJlYWQgPT4gIVsnLicsJy4uJ10uaW5jbHVkZXMocmVhZC5lbnRyeSkgJiYgcmVhZC50eXBlID09PSAnRElSRUNUT1JZJylcbiAgICAgIC5tYXAocmVhZCA9PiByZWFkLmVudHJ5KVxuICB9XG5cbiAgYXN5bmMgbGlzdEZpbGVzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCByZWFkcyA9IGF3YWl0IE5ldXRyYWxpbm8uZmlsZXN5c3RlbS5yZWFkRGlyZWN0b3J5KCB0aGlzLnBhdGggKVxuICAgIHJldHVybiByZWFkcy5maWx0ZXIocmVhZCA9PiAhWycuJywnLi4nXS5pbmNsdWRlcyhyZWFkLmVudHJ5KSAmJiByZWFkLnR5cGUgIT09ICdESVJFQ1RPUlknKVxuICAgICAgLm1hcChyZWFkID0+IHJlYWQuZW50cnkpXG4gIH1cblxuICBhc3luYyBnZXRGb2xkZXJzKCk6IFByb21pc2U8TmV1dHJhbGlub0RpcmVjdG9yeU1hbmFnZXJbXT4ge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChcbiAgICAgIChhd2FpdCB0aGlzLmxpc3RGb2xkZXJzKCkpLm1hcChhc3luYyBuYW1lID0+IGF3YWl0IHRoaXMuZ2V0RGlyZWN0b3J5KG5hbWUpKVxuICAgIClcbiAgfVxuXG4gIGFzeW5jIGdldEZpbGVzKCk6IFByb21pc2U8RG1GaWxlUmVhZGVyW10+IHtcbiAgICBjb25zdCByZWFkcyA9IGF3YWl0IE5ldXRyYWxpbm8uZmlsZXN5c3RlbS5yZWFkRGlyZWN0b3J5KCB0aGlzLnBhdGggKVxuICAgIHJldHVybiByZWFkcy5maWx0ZXIocmVhZCA9PiAhWycuJywnLi4nXS5pbmNsdWRlcyhyZWFkLmVudHJ5KSAmJiByZWFkLnR5cGUgIT09ICdESVJFQ1RPUlknKVxuICAgICAgLm1hcChyZWFkID0+IG5ldyBOZXV0cmFsaW5vRG1GaWxlUmVhZGVyKHRoaXMuZ2V0RnVsbFBhdGgocmVhZC5lbnRyeSksIHRoaXMpKVxuICB9XG5cbiAgYXN5bmMgZ2V0RGlyZWN0b3J5KG5ld1BhdGg6IHN0cmluZykge1xuICAgIGNvbnN0IHBhdGhUbyA9IHBhdGguam9pbih0aGlzLnBhdGgsIG5ld1BhdGgpXG4gICAgXG4gICAgLy8gZW5zdXJlIHBhdGggZXhpc3RzXG4gICAgYXdhaXQgTmV1dHJhbGluby5maWxlc3lzdGVtLnJlYWREaXJlY3RvcnkocGF0aFRvKVxuICAgIFxuICAgIHJldHVybiBuZXcgTmV1dHJhbGlub0RpcmVjdG9yeU1hbmFnZXIoIHBhdGhUbyApXG4gIH1cblxuICBhc3luYyBmaW5kRmlsZUJ5UGF0aCAoXG4gICAgZmlsZVBhdGg6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxOZXV0cmFsaW5vRG1GaWxlUmVhZGVyPiB7XG4gICAgY29uc3QgZnVsbEZpbGVQYXRoID0gdGhpcy5nZXRGdWxsUGF0aChmaWxlUGF0aClcbiAgICByZXR1cm4gbmV3IE5ldXRyYWxpbm9EbUZpbGVSZWFkZXIoZnVsbEZpbGVQYXRoLCB0aGlzKVxuICB9XG5cbiAgZmlsZShmaWxlTmFtZTogc3RyaW5nLCBfb3B0aW9ucz86IEZpbGVTeXN0ZW1HZXRGaWxlT3B0aW9ucykge1xuICAgIHJldHVybiB0aGlzLmZpbmRGaWxlQnlQYXRoKGZpbGVOYW1lKVxuICB9XG5cbiAgZ2V0RnVsbFBhdGgoaXRlbVBhdGg6IHN0cmluZykge1xuICAgIGxldCBmdWxsRmlsZVBhdGggPSBwYXRoLmpvaW4odGhpcy5wYXRoLCBpdGVtUGF0aClcbiAgICByZXR1cm4gY29udmVydFNsYXNoZXMoZnVsbEZpbGVQYXRoKVxuICB9XG59XG4iXX0=