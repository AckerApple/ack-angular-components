import { getNameByPath } from "./BrowserDirectoryManagers";
import { convertSlashes } from "./convertSlashes";
import { BaseDmFileReader } from "./DirectoryManagers";
import { path } from "./path";
const fs = typeof Neutralino === 'object' ? Neutralino.filesystem : {};
export class NeutralinoDmFileReader extends BaseDmFileReader {
    constructor(filePath, directory) {
        super();
        this.filePath = filePath;
        this.directory = directory;
        this.name = filePath.split('/').pop();
    }
    async stats() {
        return fs.getStats(this.filePath);
    }
    readAsText() {
        return fs.readFile(this.filePath); // .toString()
    }
    async write(fileString) {
        return fs.writeFile(this.filePath, fileString);
    }
}
export class NeutralinoDirectoryManager {
    constructor(path) {
        this.path = path;
        this.name = getNameByPath(path);
    }
    async list() {
        const reads = await Neutralino.filesystem.readDirectory(this.path);
        return reads.filter(read => !['.', '..'].includes(read.entry)).map(read => read.entry);
    }
    async listFolders() {
        const reads = await Neutralino.filesystem.readDirectory(this.path);
        return reads.filter(read => !['.', '..'].includes(read.entry) && read.type === 'DIRECTORY')
            .map(read => read.entry);
    }
    async listFiles() {
        const reads = await Neutralino.filesystem.readDirectory(this.path);
        return reads.filter(read => !['.', '..'].includes(read.entry) && read.type !== 'DIRECTORY')
            .map(read => read.entry);
    }
    async getFolders() {
        return Promise.all((await this.listFolders()).map(async (name) => await this.getDirectory(name)));
    }
    async getFiles() {
        const reads = await Neutralino.filesystem.readDirectory(this.path);
        return reads.filter(read => !['.', '..'].includes(read.entry) && read.type !== 'DIRECTORY')
            .map(read => new NeutralinoDmFileReader(this.getFullPath(read.entry), this));
    }
    async getDirectory(newPath) {
        return new NeutralinoDirectoryManager(path.join(this.path, newPath));
    }
    async findFileByPath(filePath) {
        const fullFilePath = this.getFullPath(filePath);
        return new NeutralinoDmFileReader(fullFilePath, this);
    }
    file(fileName, _options) {
        return this.findFileByPath(fileName);
    }
    getFullPath(itemPath) {
        let fullFilePath = path.join(this.path, itemPath);
        return convertSlashes(fullFilePath);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTmV1dHJhbGlub0RpcmVjdG9yeU1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZGlyZWN0b3J5LW1hbmFnZXJzL05ldXRyYWxpbm9EaXJlY3RvcnlNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQTtBQUMxRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFDakQsT0FBTyxFQUFFLGdCQUFnQixFQUFrQyxNQUFNLHFCQUFxQixDQUFBO0FBQ3RGLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxRQUFRLENBQUE7QUFhN0IsTUFBTSxFQUFFLEdBQUcsT0FBTyxVQUFVLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFtQixDQUFBO0FBRXZGLE1BQU0sT0FBTyxzQkFBdUIsU0FBUSxnQkFBZ0I7SUFHMUQsWUFDUyxRQUFnQixFQUNoQixTQUFxQztRQUU1QyxLQUFLLEVBQUUsQ0FBQTtRQUhBLGFBQVEsR0FBUixRQUFRLENBQVE7UUFDaEIsY0FBUyxHQUFULFNBQVMsQ0FBNEI7UUFHNUMsSUFBSSxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBWSxDQUFBO0lBQ2pELENBQUM7SUFFRCxLQUFLLENBQUMsS0FBSztRQUNULE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUVRLFVBQVU7UUFDakIsT0FBTyxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFDLGNBQWM7SUFDbEQsQ0FBQztJQUVELEtBQUssQ0FBQyxLQUFLLENBQUMsVUFBa0I7UUFDNUIsT0FBTyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUks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QUN4RSxDQUFDO0lBRUQsS0FBSyxDQUFDLGNBQWMsQ0FDbEIsUUFBZ0I7UUFFaEIsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUMvQyxPQUFPLElBQUksc0JBQXNCLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQ3ZELENBQUM7SUFFRCxJQUFJLENBQUMsUUFBZ0IsRUFBRSxRQUFtQztRQUN4RCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDdEMsQ0FBQztJQUVELFdBQVcsQ0FBQyxRQUFnQjtRQUMxQixJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFDakQsT0FBTyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUE7SUFDckMsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0TmFtZUJ5UGF0aCB9IGZyb20gXCIuL0Jyb3dzZXJEaXJlY3RvcnlNYW5hZ2Vyc1wiXG5pbXBvcnQgeyBjb252ZXJ0U2xhc2hlcyB9IGZyb20gXCIuL2NvbnZlcnRTbGFzaGVzXCJcbmltcG9ydCB7IEJhc2VEbUZpbGVSZWFkZXIsIERpcmVjdG9yeU1hbmFnZXIsIERtRmlsZVJlYWRlciB9IGZyb20gXCIuL0RpcmVjdG9yeU1hbmFnZXJzXCJcbmltcG9ydCB7IHBhdGggfSBmcm9tIFwiLi9wYXRoXCJcblxuaW50ZXJmYWNlIElOZXV0cmFsaW5vIHtcbiAgZmlsZXN5c3RlbTogSU5ldXRyYWxpbm9Gc1xufVxuaW50ZXJmYWNlIElOZXV0cmFsaW5vRnMge1xuICBnZXRTdGF0czogKHBhdGg6IHN0cmluZykgPT4gYW55XG4gIHJlYWRGaWxlOiAocGF0aDogc3RyaW5nKSA9PiBhbnlcbiAgd3JpdGVGaWxlOiAocGF0aDogc3RyaW5nLCBkYXRhOiBzdHJpbmcpID0+IGFueVxuICByZWFkRGlyZWN0b3J5OiAocGF0aDogc3RyaW5nKSA9PiBQcm9taXNlPHtlbnRyeTogJ0ZJTEUnIHwgJ0RJUkVDVE9SWScsIHR5cGU6IHN0cmluZ31bXT5cbn1cblxuZGVjbGFyZSBjb25zdCBOZXV0cmFsaW5vOiBJTmV1dHJhbGlub1xuY29uc3QgZnMgPSB0eXBlb2YgTmV1dHJhbGlubyA9PT0gJ29iamVjdCcgPyBOZXV0cmFsaW5vLmZpbGVzeXN0ZW0gOiB7fSBhcyBJTmV1dHJhbGlub0ZzXG5cbmV4cG9ydCBjbGFzcyBOZXV0cmFsaW5vRG1GaWxlUmVhZGVyIGV4dGVuZHMgQmFzZURtRmlsZVJlYWRlciBpbXBsZW1lbnRzIERtRmlsZVJlYWRlciB7XG4gIG5hbWU6IHN0cmluZ1xuICBcbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGZpbGVQYXRoOiBzdHJpbmcsXG4gICAgcHVibGljIGRpcmVjdG9yeTogTmV1dHJhbGlub0RpcmVjdG9yeU1hbmFnZXIsXG4gICkge1xuICAgIHN1cGVyKClcbiAgICB0aGlzLm5hbWUgPSBmaWxlUGF0aC5zcGxpdCgnLycpLnBvcCgpIGFzIHN0cmluZ1xuICB9XG5cbiAgYXN5bmMgc3RhdHMoKSB7XG4gICAgcmV0dXJuIGZzLmdldFN0YXRzKHRoaXMuZmlsZVBhdGgpXG4gIH1cblxuICBvdmVycmlkZSByZWFkQXNUZXh0KCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgcmV0dXJuIGZzLnJlYWRGaWxlKHRoaXMuZmlsZVBhdGgpIC8vIC50b1N0cmluZygpXG4gIH1cblxuICBhc3luYyB3cml0ZShmaWxlU3RyaW5nOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gZnMud3JpdGVGaWxlKHRoaXMuZmlsZVBhdGgsIGZpbGVTdHJpbmcpXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIE5ldXRyYWxpbm9EaXJlY3RvcnlNYW5hZ2VyIGltcGxlbWVudHMgRGlyZWN0b3J5TWFuYWdlciB7XG4gIG5hbWU6IHN0cmluZ1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBwYXRoOiBzdHJpbmcsXG4gICkge1xuICAgIHRoaXMubmFtZSA9IGdldE5hbWVCeVBhdGgocGF0aClcbiAgfVxuXG4gIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGNvbnN0IHJlYWRzID0gYXdhaXQgTmV1dHJhbGluby5maWxlc3lzdGVtLnJlYWREaXJlY3RvcnkoIHRoaXMucGF0aCApXG4gICAgcmV0dXJuIHJlYWRzLmZpbHRlcihyZWFkID0+ICFbJy4nLCcuLiddLmluY2x1ZGVzKHJlYWQuZW50cnkpKS5tYXAocmVhZCA9PiByZWFkLmVudHJ5KVxuICB9XG5cbiAgYXN5bmMgbGlzdEZvbGRlcnMoKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGNvbnN0IHJlYWRzID0gYXdhaXQgTmV1dHJhbGluby5maWxlc3lzdGVtLnJlYWREaXJlY3RvcnkoIHRoaXMucGF0aCApXG4gICAgcmV0dXJuIHJlYWRzLmZpbHRlcihyZWFkID0+ICFbJy4nLCcuLiddLmluY2x1ZGVzKHJlYWQuZW50cnkpICYmIHJlYWQudHlwZSA9PT0gJ0RJUkVDVE9SWScpXG4gICAgICAubWFwKHJlYWQgPT4gcmVhZC5lbnRyeSlcbiAgfVxuXG4gIGFzeW5jIGxpc3RGaWxlcygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgcmVhZHMgPSBhd2FpdCBOZXV0cmFsaW5vLmZpbGVzeXN0ZW0ucmVhZERpcmVjdG9yeSggdGhpcy5wYXRoIClcbiAgICByZXR1cm4gcmVhZHMuZmlsdGVyKHJlYWQgPT4gIVsnLicsJy4uJ10uaW5jbHVkZXMocmVhZC5lbnRyeSkgJiYgcmVhZC50eXBlICE9PSAnRElSRUNUT1JZJylcbiAgICAgIC5tYXAocmVhZCA9PiByZWFkLmVudHJ5KVxuICB9XG5cbiAgYXN5bmMgZ2V0Rm9sZGVycygpOiBQcm9taXNlPE5ldXRyYWxpbm9EaXJlY3RvcnlNYW5hZ2VyW10+IHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoXG4gICAgICAoYXdhaXQgdGhpcy5saXN0Rm9sZGVycygpKS5tYXAoYXN5bmMgbmFtZSA9PiBhd2FpdCB0aGlzLmdldERpcmVjdG9yeShuYW1lKSlcbiAgICApXG4gIH1cblxuICBhc3luYyBnZXRGaWxlcygpOiBQcm9taXNlPERtRmlsZVJlYWRlcltdPiB7XG4gICAgY29uc3QgcmVhZHMgPSBhd2FpdCBOZXV0cmFsaW5vLmZpbGVzeXN0ZW0ucmVhZERpcmVjdG9yeSggdGhpcy5wYXRoIClcbiAgICByZXR1cm4gcmVhZHMuZmlsdGVyKHJlYWQgPT4gIVsnLicsJy4uJ10uaW5jbHVkZXMocmVhZC5lbnRyeSkgJiYgcmVhZC50eXBlICE9PSAnRElSRUNUT1JZJylcbiAgICAgIC5tYXAocmVhZCA9PiBuZXcgTmV1dHJhbGlub0RtRmlsZVJlYWRlcih0aGlzLmdldEZ1bGxQYXRoKHJlYWQuZW50cnkpLCB0aGlzKSlcbiAgfVxuXG4gIGFzeW5jIGdldERpcmVjdG9yeShuZXdQYXRoOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gbmV3IE5ldXRyYWxpbm9EaXJlY3RvcnlNYW5hZ2VyKCBwYXRoLmpvaW4odGhpcy5wYXRoLCBuZXdQYXRoKSApXG4gIH1cblxuICBhc3luYyBmaW5kRmlsZUJ5UGF0aCAoXG4gICAgZmlsZVBhdGg6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxOZXV0cmFsaW5vRG1GaWxlUmVhZGVyPiB7XG4gICAgY29uc3QgZnVsbEZpbGVQYXRoID0gdGhpcy5nZXRGdWxsUGF0aChmaWxlUGF0aClcbiAgICByZXR1cm4gbmV3IE5ldXRyYWxpbm9EbUZpbGVSZWFkZXIoZnVsbEZpbGVQYXRoLCB0aGlzKVxuICB9XG5cbiAgZmlsZShmaWxlTmFtZTogc3RyaW5nLCBfb3B0aW9ucz86IEZpbGVTeXN0ZW1HZXRGaWxlT3B0aW9ucykge1xuICAgIHJldHVybiB0aGlzLmZpbmRGaWxlQnlQYXRoKGZpbGVOYW1lKVxuICB9XG5cbiAgZ2V0RnVsbFBhdGgoaXRlbVBhdGg6IHN0cmluZykge1xuICAgIGxldCBmdWxsRmlsZVBhdGggPSBwYXRoLmpvaW4odGhpcy5wYXRoLCBpdGVtUGF0aClcbiAgICByZXR1cm4gY29udmVydFNsYXNoZXMoZnVsbEZpbGVQYXRoKVxuICB9XG59XG4iXX0=